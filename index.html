<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WonderSound</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background-color: #121212; color: white; }
        .container { max-width: 800px; margin: auto; }
        button { padding: 10px; margin: 10px; background-color: #1db954; color: white; border: none; cursor: pointer; }
        input, select { padding: 5px; margin: 5px; }
        .song-list { margin-top: 20px; }
        .song { padding: 10px; background: #222; margin: 5px; display: flex; justify-content: space-between; align-items: center; }
        .arrow-up { color: green; }
        .arrow-down { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <h1>WonderSound</h1>
        
        <h2>Dodaj Artystę</h2>
        <input type="text" id="artistName" placeholder="Nazwa artysty">
        <button onclick="addArtist()">Dodaj</button>
        
        <h2>Dodaj Piosenkę</h2>
        <input type="text" id="songTitle" placeholder="Tytuł piosenki">
        <select id="artistSelect"></select>
        <button onclick="addSong()">Dodaj</button>
        
        <h2>Global 100</h2>
        <div id="global100" class="song-list"></div>
        
        <h2>Total Streams</h2>
        <div id="totalStreams" class="song-list"></div>
        
        <button onclick="updateStreams()">Aktualizuj Odtworzenia</button>
    </div>
    
    <script>
        let artists = {};
        let songs = [];
        
        function addArtist() {
            let name = document.getElementById("artistName").value;
            if (name && !artists[name]) {
                artists[name] = { name: name, songs: [], totalStreams: 0 };
                let option = document.createElement("option");
                option.value = name;
                option.textContent = name;
                document.getElementById("artistSelect").appendChild(option);
                document.getElementById("artistName").value = "";
            }
        }
        
        function addSong() {
            let title = document.getElementById("songTitle").value;
            let artist = document.getElementById("artistSelect").value;
            if (title && artist) {
                let song = { 
                    title: title, 
                    artist: artist, 
                    streams: 0, 
                    totalStreams: 0, 
                    peakPosition: 100, 
                    lastPosition: 100, 
                    currentPosition: 100, 
                    lastTotalPosition: 100, 
                    currentTotalPosition: 100, 
                    peakTotalPosition: 100, // Nowa wartość dla total streams
                    daysOnChart: 0 
                };
                songs.push(song);
                artists[artist].songs.push(song);
                document.getElementById("songTitle").value = "";
                renderCharts();
            }
        }
        
        function updateStreams() {
            songs.forEach(song => {
                if (song.totalStreams === 0) {
                    song.streams = Math.floor(Math.random() * (10000000 - 1000000 + 1)) + 1000000;
                } else {
                    let randomChange = (Math.random() * 0.2 - 0.1);  
                    let newStreams = song.streams * (1 + randomChange); 
                    newStreams = Math.min(newStreams, 13000000);  
                    song.streams = Math.floor(Math.max(newStreams, 0));  

                    song.streams -= Math.floor(song.streams * 0.005);
                    if (song.streams < 0) song.streams = 0;
                }

                song.totalStreams += song.streams;
                artists[song.artist].totalStreams += song.streams;
                song.daysOnChart++;
            });
            renderCharts();
        }
        
        function renderCharts() {
            songs.sort((a, b) => b.streams - a.streams);
            let global100 = document.getElementById("global100");
            global100.innerHTML = "";
            songs.forEach((song, index) => {
                song.lastPosition = song.currentPosition;
                song.currentPosition = index + 1;
                if (index < 100) {
                    song.peakPosition = Math.min(song.peakPosition, index + 1);
                }
                
                let movement = "";
                if (song.lastPosition > song.currentPosition) {
                    movement = `<span class='arrow-up'>&uarr; ${song.lastPosition - song.currentPosition}</span>`;
                } else if (song.lastPosition < song.currentPosition) {
                    movement = `<span class='arrow-down'>&darr; ${song.currentPosition - song.lastPosition}</span>`;
                }
                
                let songDiv = document.createElement("div");
                songDiv.className = "song";
                songDiv.innerHTML = `${index + 1}. ${song.title} - ${song.artist} (${song.streams} aktualne odtworzenia) ${movement} | Peak: ${song.peakPosition} | Dni na liście: ${song.daysOnChart}`;
                global100.appendChild(songDiv);
            });

            songs.sort((a, b) => b.totalStreams - a.totalStreams);
            let totalStreams = document.getElementById("totalStreams");
            totalStreams.innerHTML = "";
            songs.forEach((song, index) => {
                song.lastTotalPosition = song.currentTotalPosition;
                song.currentTotalPosition = index + 1;
                song.peakTotalPosition = Math.min(song.peakTotalPosition, index + 1); // Aktualizacja peak Total Streams
                
                let movement = "";
                if (song.lastTotalPosition > song.currentTotalPosition) {
                    movement = `<span class='arrow-up'>&uarr; ${song.lastTotalPosition - song.currentTotalPosition}</span>`;
                } else if (song.lastTotalPosition < song.currentTotalPosition) {
                    movement = `<span class='arrow-down'>&darr; ${song.currentTotalPosition - song.lastTotalPosition}</span>`;
                }
                
                let songDiv = document.createElement("div");
                songDiv.className = "song";
                songDiv.innerHTML = `${index + 1}. ${song.title} - ${song.artist} (${song.totalStreams} sumaryczne odtworzenia) ${movement} | Peak: ${song.peakTotalPosition} | Dni na liście: ${song.daysOnChart}`;
                totalStreams.appendChild(songDiv);
            });
        }
    </script>
</body>
</html>
